<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blockly Demo: Custom RoBlockWar Blocks</title>
  <script src="/../Blockly/blockly_compressed.js"></script>
  <script src="/../Blockly/blocks_compressed.js"></script>
  <script src="/../Blockly/msg/js/en.js"></script>
  <script src="/../Blockly/javascript_compressed.js"></script>

  <script src="./bin/roblockwar.blocks.js"></script>
  
  <style>
    body {
      background-color: #fff;
      font-family: sans-serif;
    }
    h1 {
      font-weight: normal;
      font-size: 140%;
    }
  </style>
</head>
<body>
  <div style="height: 500px;width: 90%; float:left; overflow: auto;">
    <h1>RoBlockly Workspace</h1>
    <div id="blocklyDiv" style="height: 85%; width: 97%;"></div>
  </div>
  
  <br style="clear:both;"/>
  <br style="clear:both;"/>
  <hr/>
  <div style="height: 500px;width: 45%; float:left; overflow: auto;">
    <h1>JS Generated from Workspace:</h1>
    <pre><code id="jsResult" style="height: 97%; width: 97%;" ></code></pre>
    <hr/>
  </div>
  <div style="height: 500px;width: 45%; float:right; overflow: auto;">
    <h1>XML Generated from Workspace:</h1>
    <textarea id="xmlResult" rows="15" cols="75" ></textarea>
  </div>
  
  <br style="clear:both;"/>
  <br style="clear:both;"/>
  <hr/>
  <xml id="toolbox" style="display: none">
    <category name="Program Flow">
      <block type="controls_whileUntil"></block>
      <block type="controls_if"></block>
      <block type="logic_compare"></block>
    </category>
    <category name="Instructions">
      <block type="roblockwar_getRegister"></block>
      <block type="roblockwar_setRegister"></block>
      <block type="roblockwar_radar"></block>
      <block type="roblockwar_fire"></block>
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
    </category>
    <category name="Instruction Groups" custom="PROCEDURE">
    </category>
  </xml>
  
  <xml id="DefaultWorkSpace" style="display:none;">
   
  </xml>
  <script type="text/javascript" id="run_webpage_code">
    function replaceAll(find, replace, str) {
      return str.replace(new RegExp(find, 'g'), replace);
    }
    Blockly.inject(document.getElementById('blocklyDiv'),
        {toolbox: document.getElementById('toolbox')});
    function myUpdateFunction() {
      var code = Blockly.JavaScript.workspaceToCode();
      var newline = String.fromCharCode(13, 10) || '\n';
      code = replaceAll("}", "}" + newline, code);
      code = replaceAll(":", ":" + newline, code);
      code = replaceAll(";", ";" + newline, code);
      code = replaceAll("{", "{" + newline, code);
      document.getElementById('jsResult').innerHTML = code;
      
      var xml = Blockly.Xml.workspaceToDom(Blockly.mainWorkspace);
      var xml_text = Blockly.Xml.domToText(xml);
      document.getElementById('xmlResult').innerHTML = xml_text;
    }
    Blockly.addChangeListener(myUpdateFunction);
    var xml_text = document.getElementById('DefaultWorkSpace').innerHTML;
    var xml = Blockly.Xml.textToDom(xml_text);
    Blockly.Xml.domToWorkspace(Blockly.mainWorkspace, xml);
  </script>
  
</body>
</html>